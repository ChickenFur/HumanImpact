// Generated by CoffeeScript 1.4.0
(function() {

  require(["findBirth"], function(findBirth) {
    var _getAndSendToDB, _showResult;
    $(document).ready(function() {
      $('.nameInput').on("keyup", function(event) {
        if (event.keyCode === 13) {
          return $('.findBirthDate').click();
        }
      });
      return $('.findBirthDate').on("click", function(event) {
        var settings;
        settings = {
          url: "/getPerson/?wikipage=" + ($(".nameInput").val()),
          success: function(data) {
            if (data.name) {
              _showResult(data.name, data.dob, data.url, data.relations);
            }
            if (data === "Not In DB") {
              return _getAndSendToDB($(".nameInput").val());
            }
          },
          error: function(err) {
            return console.log("Error in Get Person Ajax Request:", err);
          }
        };
        return $.ajax(settings);
      });
    });
    _getAndSendToDB = function(name) {
      return findBirth(name, function(birth) {
        var settings;
        settings = {
          url: "/savePerson/?name=" + name + "&dob=" + birth + "&relations=[]",
          success: function(data) {
            _showResult(name, birth, "http://en.wikipedia.org/" + name, "");
            return $(".result").append("Added to DB");
          },
          error: function(err) {
            return console.log("Error Getting Date");
          }
        };
        return $.ajax(settings);
      });
    };
    return _showResult = function(name, dob, page, relations) {
      $(".result").html("");
      $(".result").append("Name: " + name + "<br>");
      $(".result").append("DOB: " + dob + "<br>");
      $(".result").append("URL: " + page + "<br>");
      return $(".result").append("Relations: " + relations + "<br>");
    };
  });

}).call(this);
